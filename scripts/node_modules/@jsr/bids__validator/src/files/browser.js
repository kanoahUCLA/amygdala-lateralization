import { BIDSFile, FileTree } from "../types/filetree.js";
import { filesToTree } from "./filetree.js";
import { FileIgnoreRules, readBidsIgnore } from "./ignore.js";
import { BrowserFileOpener } from "./openers.js";
/**
 * Browser implement of BIDSFile wrapping native File/FileList types
 */ export class BIDSFileBrowser extends BIDSFile {
  constructor(file, ignore, parent){
    const relativePath = file.webkitRelativePath;
    const prefixLength = relativePath.indexOf('/');
    const opener = new BrowserFileOpener(file);
    super(relativePath.substring(prefixLength), opener, ignore, parent);
  }
}
/**
 * Convert from FileList (created with webkitDirectory: true) to FileTree for validator use
 */ export async function fileListToTree(files) {
  const ignore = new FileIgnoreRules([]);
  const root = new FileTree('/', '/', undefined);
  const tree = filesToTree(files.map((f)=>new BIDSFileBrowser(f, ignore, root)), ignore);
  const bidsignore = tree.get('.bidsignore');
  if (bidsignore) {
    try {
      ignore.add(await readBidsIgnore(bidsignore));
    } catch (err) {
      console.log(`Failed to read '.bidsignore' file with the following error:\n${err}`);
    }
  }
  return tree;
}
//# sourceMappingURL=browser.js.map