import { getOs } from "jsr:@cliffy/internal@1.0.0-rc.8/runtime/get-os";
import { test } from "jsr:@cliffy/internal@1.0.0-rc.8/testing/test";
import { assertEquals, assertRejects } from "jsr:@std/assert@~1.0.6";
import { bold, red } from "jsr:/@std/fmt@~1.0.2/colors";
import { Confirm } from "../confirm.ts";

test("prompt confirm: y", async () => {
  console.log();
  Confirm.inject("y");
  const result: boolean | undefined = await Confirm.prompt("message");
  assertEquals(result, true);
});

test("prompt confirm: yes", async () => {
  console.log();
  Confirm.inject("Yes");
  const result: boolean | undefined = await Confirm.prompt("message");
  assertEquals(result, true);
});

test("prompt confirm: n", async () => {
  console.log();
  Confirm.inject("n");
  const result: boolean | undefined = await Confirm.prompt("message");
  assertEquals(result, false);
});

test("prompt confirm: no", async () => {
  console.log();
  Confirm.inject("No");
  const result: boolean | undefined = await Confirm.prompt("message");
  assertEquals(result, false);
});

test("prompt confirm: empty value", async () => {
  console.log();
  await assertRejects(
    async () => {
      Confirm.inject("");
      await Confirm.prompt("message");
    },
    Error,
    red(
      `${getOs() === "windows" ? bold("× ") : bold("✘ ")}Invalid answer.`,
    ),
  );
});

test("prompt confirm: invalid value", async () => {
  console.log();
  await assertRejects(
    async () => {
      Confirm.inject("noo");
      await Confirm.prompt("message");
    },
    Error,
    red(
      `${getOs() === "windows" ? bold("× ") : bold("✘ ")}Invalid answer.`,
    ),
  );
});

test("prompt confirm: null value", async () => {
  console.log();
  await assertRejects(
    async () => {
      // deno-lint-ignore no-explicit-any
      Confirm.inject(null as any);
      await Confirm.prompt("message");
    },
    Error,
    red(
      `${getOs() === "windows" ? bold("× ") : bold("✘ ")}Invalid answer.`,
    ),
  );
});
